C51 COMPILER V9.60.7.0   A96L116_ADC                                                       11/09/2025 17:18:29 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE A96L116_ADC
OBJECT MODULE PLACED IN A96L116_adc.OBJ
COMPILER INVOKED BY: C:\Users\compro\AppData\Local\Keil_v5\C51\BIN\C51.EXE A96L116_adc.c LARGE OPTIMIZE(8,SPEED) BROWSE 
                    -DEBUG OBJECTEXTEND TABS(2)

line level    source

   1          /**
   2           *******************************************************************************
   3           * @file        a96l116_adc.c
   4           * @author      ABOV R&D Division
   5           * @brief       ADC Source File
   6           *
   7           * Copyright 2020 ABOV Semiconductor Co.,Ltd. All rights reserved.
   8           *
   9           * This file is licensed under terms that are found in the LICENSE file
  10           * located at Document directory.
  11           * If this file is delivered or shared without applicable license terms,
  12           * the terms of the BSD-3-Clause license shall be applied.
  13           * Reference: https://opensource.org/licenses/BSD-3-Clause
  14           ******************************************************************************/
  15          
  16          /*******************************************************************************
  17          * Included File
  18          *******************************************************************************/
  19          #include "A96L116_adc.h"
  20          
  21          /*******************************************************************************
  22          * Private Pre-processor Definition & Macro
  23          *******************************************************************************/
  24          
  25          /*******************************************************************************
  26          * Private Typedef
  27          *******************************************************************************/
  28          
  29          /*******************************************************************************
  30          * Private Variable
  31          *******************************************************************************/
  32          uint8_t adc_count = 0;
  33          uint16_t *adc_buff;
  34          uint8_t buff_cnt = 0;
  35          /*******************************************************************************
  36          * Private Function Prototype
  37          *******************************************************************************/
  38          
  39          /*******************************************************************************
  40          * Public Function
  41          *******************************************************************************/
  42          /**
  43          * @brief    Get data of ADC conversion for ADC interrupt.
  44          * @param   adc_data   This parameter contains the data of conversion ADC.
  45          * @param   count    This parameter contains the number of count.
  46          * @return   None
  47          */
  48          void ADC_GetDataWithInterrupt(uint16_t *adc_data, uint8_t count)
  49          {
  50   1        adc_count = count;
  51   1        adc_buff = (uint16_t*)adc_data;
  52   1        buff_cnt = 0;
  53   1        
  54   1        IE3  |= 0x01; 
C51 COMPILER V9.60.7.0   A96L116_ADC                                                       11/09/2025 17:18:29 PAGE 2   

  55   1      
  56   1        if( ((ADCCRH & 0x30) == 0x00)) //SW trigger
  57   1        {
  58   2          ADCCRL |= (1 << 6);
  59   2        }
  60   1        
  61   1        while(0 < adc_count);  //adc interrupt subroutine execute
  62   1        ADCCRH &= ~0x80;
  63   1        IE3 &= ~0x01;
  64   1      }
  65          
  66          void ADC_Int_Handler(void) interrupt ADC_VECT
  67          {
  68   1        adc_buff[buff_cnt++] = (ADCDRH << 8) + (ADCDRL << 0);
  69   1        
  70   1        adc_count--;
  71   1        if(((ADCCRH & 0x30) == 0x00) && (adc_count != 0)) //SW trigger
  72   1          ADCCRL |= (1 << 6);
  73   1      
  74   1        ADCCRH &= ~0x80;
  75   1      }
  76          
  77          /* --------------------------------- End Of File ------------------------------ */


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    177    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =      5    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
